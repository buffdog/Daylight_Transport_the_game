<canvas id="game"></canvas>
<button id="restart">Restart</button>

<!-- Optional on-screen controls -->
<div id="controls">
  <button id="leftBtn">⬅️</button>
  <button id="rightBtn">➡️</button>
</div>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  canvas {
    width: 100%;
    height: auto;
    touch-action: none; /* Prevents scrolling when swiping */
    display: block;
    margin: auto;
    background: gray;
  }
  #restart {
    margin: 10px;
    padding: 10px 20px;
    font-size: 18px;
  }
  #controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 40px;
  }
  #controls button {
    font-size: 2rem;
    padding: 20px;
    border-radius: 50%;
    background: #333;
    color: white;
    border: none;
  }
</style>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let width, height;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  width = canvas.width;
  height = canvas.height;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

const laneCount = 4;
let laneWidth = width / laneCount;
let truckLane = 1;

let truck = {
  x: laneWidth * truckLane + (laneWidth - 50) / 2,
  y: height - 200,
  width: 50,
  height: 50,
  targetX: null,
  cargoOffset: 0,
  cargoDirection: 1
};

let cars = [];
let powerUps = [];
let score = 0;
let highScore = 0;
let speed = 2;
let gameOver = false;
let sceneryOffset = 0;

// Boost system
let boostActive = false;
let boostTimer = 0;

// Images
const logoImage = new Image();
logoImage.src = "daylight-logo.png";

const powerUpImage = new Image();
powerUpImage.src = "Urgent Care-logo.png";

function spawnCar() {
  if (cars.length >= 3) return;
  const carWidth = 40;
  const carHeight = 70;
  const colors = ["black", "red", "blue", "green", "purple", "orange"];
  const color = colors[Math.floor(Math.random() * colors.length)];
  let occupiedLanes = new Set(cars.map(car => Math.floor(car.x / laneWidth)));
  let availableLanes = [...Array(laneCount).keys()].filter(l => !occupiedLanes.has(l));
  if (availableLanes.length === 0) return;
  let lane = availableLanes[Math.floor(Math.random() * availableLanes.length)];
  const x = lane * laneWidth + (laneWidth - carWidth) / 2;
  cars.push({ x, y: -carHeight, width: carWidth, height: carHeight, color });
}

function spawnPowerUp() {
  if (powerUps.length >= 1) return;
  const size = 60;
  let lane = Math.floor(Math.random() * laneCount);
  const x = lane * laneWidth + (laneWidth - size) / 2;
  powerUps.push({ x, y: -size, width: size, height: size });
}

function drawTruck() {
  if (truck.targetX !== null) {
    const dx = truck.targetX - truck.x;
    if (Math.abs(dx) < 1) {
      truck.x = truck.targetX;
      truck.targetX = null;
    } else {
      truck.x += dx * 0.2;
    }
  }

  truck.cargoOffset += truck.cargoDirection * 0.2;
  if (Math.abs(truck.cargoOffset) > 2) truck.cargoDirection *= -1;

  if (boostActive) {
    ctx.shadowColor = "orange";
    ctx.shadowBlur = 20;
  } else {
    ctx.shadowBlur = 0;
  }

  ctx.fillStyle = "white";
  ctx.fillRect(truck.x, truck.y, truck.width, truck.height);

  ctx.fillStyle = "lightblue";
  ctx.fillRect(truck.x + 5, truck.y + 10, truck.width - 10, 10);

  ctx.fillStyle = "yellow";
  ctx.fillRect(truck.x + 5, truck.y, 5, 5);
  ctx.fillRect(truck.x + truck.width - 10, truck.y, 5, 5);

  ctx.fillStyle = "red";
  ctx.fillRect(truck.x + 5, truck.y + truck.height - 5, 5, 5);
  ctx.fillRect(truck.x + truck.width - 10, truck.y + truck.height - 5, 5, 5);

  const hitchY = truck.y + truck.height;
  ctx.fillStyle = "black";
  ctx.fillRect(truck.x + truck.width / 2 - 5, hitchY, 10, 6);

  const trailerY = hitchY + 6 + truck.cargoOffset;
  ctx.fillStyle = "white";
  ctx.fillRect(truck.x, trailerY, truck.width, 120);

  if (logoImage.complete && logoImage.naturalWidth !== 0) {
    ctx.drawImage(logoImage, truck.x, trailerY, truck.width, 120);
  }

  ctx.shadowBlur = 0;
}

function drawCars() {
  cars.forEach(car => {
    ctx.fillStyle = car.color;
    ctx.fillRect(car.x, car.y, car.width, car.height);

    ctx.fillStyle = "lightblue";
    ctx.fillRect(car.x + 5, car.y + 10, car.width - 10, 10);

    ctx.fillStyle = "yellow";
    ctx.fillRect(car.x + 5, car.y, 5, 5);
    ctx.fillRect(car.x + car.width - 10, car.y, 5, 5);

    ctx.fillStyle = "red";
    ctx.fillRect(car.x + 5, car.y + car.height - 5, 5, 5);
    ctx.fillRect(car.x + car.width - 10, car.y + car.height - 5, 5, 5);
  });
}

function drawPowerUps() {
  powerUps.forEach(p => {
    if (powerUpImage.complete && powerUpImage.naturalWidth !== 0) {
      ctx.drawImage(powerUpImage, p.x, p.y, p.width, p.height);
    } else {
      ctx.fillStyle = "gold";
      ctx.fillRect(p.x, p.y, p.width, p.height);
    }
  });
}

function updateCars() {
  cars.forEach(car => car.y += speed);
  cars = cars.filter(car => car.y < height);
}

function updatePowerUps() {
  powerUps.forEach(p => p.y += speed);
  powerUps = powerUps.filter(p => p.y < height);
}

function checkCollision() {
  for (let car of cars) {
    if (
      truck.x < car.x + car.width &&
      truck.x + truck.width > car.x &&
      truck.y < car.y + car.height &&
      truck.y + truck.height > car.y
    ) {
      gameOver = true;
    }
  }
}

function checkPowerUpCollision() {
  for (let i = 0; i < powerUps.length; i++) {
    let p = powerUps[i];
    if (
      truck.x < p.x + p.width &&
      truck.x + truck.width > p.x &&
      truck.y < p.y + p.height &&
      truck.y + truck.height > p.y
    ) {
      powerUps.splice(i, 1);
      activateBoost();
      break;
    }
  }
}

function activateBoost() {
  if (!boostActive) speed += 4;
  boostActive = true;
  boostTimer = 300;
}

function updateBoost() {
  if (boostActive) {
    boostTimer--;
    if (boostTimer <= 0) {
      boostActive = false;
      speed -= 4;
    }
  }
}

function drawScore() {
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 25);
  ctx.fillText("High Score: " + highScore, 10, 50);

  if (boostActive) {
    ctx.fillStyle = "red";
    ctx.fillText("URGENT CARE!", width - 165, 50);
  }
}

function drawRoadBackground() {
  ctx.fillStyle = "gray";
  ctx.fillRect(0, 0, width, height);

  ctx.strokeStyle = "white";
  ctx.lineWidth = 4;
  ctx.setLineDash([20, 20]);
  for (let i = 1; i < laneCount; i++) {
    ctx.beginPath();
    ctx.moveTo(laneWidth * i, -40 + sceneryOffset);
    ctx.lineTo(laneWidth * i, height + 40 + sceneryOffset);
    ctx.stroke();
  }
  ctx.setLineDash([]);

  for (let i = 0; i < height; i += 80) {
    ctx.fillStyle = "green";
    ctx.beginPath();
    ctx.arc(30, i + sceneryOffset, 10, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(width - 30, i + sceneryOffset, 10, 0, Math.PI * 2);
    ctx.fill();
  }

  sceneryOffset += speed;
  if (sceneryOffset >= 40) sceneryOffset = 0;
}

function update() {
  if (gameOver) return;
  score++;
  if (score % 100 === 0 && !boostActive) speed += 0.5;
  if (Math.random() < 0.03) spawnCar();
  if (Math.random() < 0.005) spawnPowerUp();
  updateCars();
  updatePowerUps();
  checkCollision();
  checkPowerUpCollision();
  updateBoost();
}

function draw() {
  ctx.clearRect(0, 0, width, height);
  laneWidth = width / laneCount; // recalc if resized
  drawRoadBackground();
  drawTruck();
  drawCars();
  drawPowerUps();
  drawScore();
}

function loop() {
  update();
  draw();
  if (!gameOver) requestAnimationFrame(loop);
  else {
    highScore = Math.max(score, highScore);
    ctx.fillStyle = "black";
    ctx.font = "30px Arial";
    ctx.fillText("Game Over", width / 2 - 80, height / 2);
    ctx.fillText("Press Restart to Play Again", width / 2 - 160, height / 2 + 40);
  }
}

function restartGame() {
  truckLane = 1;
  truck.x = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  truck.targetX = null;
  truck.cargoOffset = 0;
  truck.cargoDirection = 1;
  cars = [];
  powerUps = [];
  score = 0;
  speed = 2;
  gameOver = false;
  boostActive = false;
  boostTimer = 0;
  loop();
}

// Keyboard controls
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" && truckLane > 0) {
    truckLane--;
    truck.targetX = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  }
  if (e.key === "ArrowRight" && truckLane < laneCount - 1) {
    truckLane++;
    truck.targetX = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  }
});

// Touch controls
canvas.addEventListener("touchstart", e => {
  const touchX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
  if (touchX < width / 2 && truckLane > 0) {
    truckLane--;
    truck.targetX = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  } else if (touchX >= width / 2 && truckLane < laneCount - 1) {
    truckLane++;
    truck.targetX = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  }
});

// On-screen button controls
document.getElementById("leftBtn").addEventListener("click", () => {
  if (truckLane > 0) {
    truckLane--;
    truck.targetX = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  }
});

document.getElementById("rightBtn").addEventListener("click", () => {
  if (truckLane < laneCount - 1) {
    truckLane++;
    truck.targetX = laneWidth * truckLane + (laneWidth - truck.width) / 2;
  }
});

document.getElementById("restart").addEventListener("click", restartGame);

loop();
</script>
